<h1><span class="fa-overlay">
    <i class="rs rs-filament"></i>
    <i class="fa fa-balance-scale fa-overlay-se" style="color:white"></i>
    <i class="fa fa-balance-scale fa-overlay-se text-primary"></i>
</span> <%- __('Left filament %s', filament.name) %></h1>

<form class="form-filament" method="POST">
    <fieldset>
        <div class="row ">
            <div class="col-md-5">
                <div class="form-group<%= (errors.leftTotalWeight || errors.weighUnit) ? " has-error" : "" %>">
                    <label for="leftTotalWeight"
                           class="control-label"><%- __('Left total weight:'); %></label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="leftTotalWeight"
                               name="leftTotalWeight"
                               value="<%- (locals.leftTotalWeight) ? leftTotalWeight : ''; %>">
                        <div class="input-group-addon">
                            <label for="weight-unit-g"><input type="radio" name="weighUnit" value="g" id="weight-unit-g" <%- (locals.weighUnit) ? (weighUnit=='g'?'checked':'') : 'checked' %>> <%- __('g'); %></label>
                            /
                            <label for="weight-unit-kg"><input type="radio" name="weighUnit" value="kg" id="weight-unit-kg" <%- (locals.weighUnit) ? (weighUnit=='kg'?'checked':'') : '' %>> <%- __('Kg'); %></label>
                        </div>
                    </div>
                    <% if (errors.leftTotalWeight || errors.weighUnit) { %>
                    <ul class="help-block with-errors">
                        <% if (errors.leftTotalWeight) { %>
                        <% errors.leftTotalWeight.forEach(function(msg) { %>
                        <li><%= __(msg) %></li>
                        <% }); %>
                        <% } %>
                        <% if (errors.weighUnit) { %>
                        <% errors.weighUnit.forEach(function(msg) { %>
                        <li><%= __(msg) %></li>
                        <% }); %>
                        <% } %>
                    </ul>
                    <% } %>
                </div>
                <div id="estimated-left-length" class="filament-left-data"></div>
            </div>
            <div class="col-md-2 form-horizontal-alternative-or">
                <div style="margin-top: 30px;"><%- __('or') %></div>
            </div>
            <div class="col-md-5">
                <div class="form-group<%= (errors.leftLength) ? " has-error" : "" %>">
                    <label for="leftLength"
                           class="control-label"><%- __('Left length:'); %></label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="leftLength"
                               name="leftLength"
                               value="<%- (locals.leftLength) ? leftLength : '' %>">
                        <div class="input-group-addon"><%- __('m'); %></div>
                    </div>
                    <% if (errors.leftLength) { %>
                    <ul class="help-block with-errors">
                        <% errors.leftLength.forEach(function(msg) { %>
                        <li><%= __(msg) %></li>
                        <% }); %>
                    </ul>
                    <% } %>
                </div>
                <div id="estimated-left-weight" class="filament-left-data"></div>
            </div>
        </div>

        <p class="button-bar">
            <a href="/filament/show/<%- filament.id %>" class="btn btn-default"><%- __('Cancel') %></a>
            <button type="submit" class="btn btn-primary"><%- __('Save') %></button>
        </p>
    </fieldset>
</form>

<script type="text/javascript">
    function filamentLeftMaterialOnChange() {
        $.ajax({
            method: 'POST',
            url: '/filament/compute-left-material/<%- filament.id %>',
            data: $('form.form-filament').serialize(),
            success: function(data) {
                $('#estimated-left-length, #estimated-left-weight').text('');

                if (data.weight) {
                    $('#estimated-left-weight').text(Locale3DPTools.__('~ %.2f Kg', data.weight));
                }
                if (data.length) {
                    $('#estimated-left-length').text(Locale3DPTools.__('~ %.2f m', data.length));
                }
            }
        });
    }
    $(function () {
        $('#leftTotalWeight,#leftLength').keyup(filamentLeftMaterialOnChange);
        $('input[name=weighUnit]').change(filamentLeftMaterialOnChange);
    });
</script>